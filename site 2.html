<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenTrack AI - Syst√®me QR</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <style>
        :root { --primary: #2D6A4F; --secondary: #52B788; --light: #f8f9fa; }
        body { font-family: sans-serif; background: #e9ecef; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-bottom: 20px; text-align: center; }
        
        h2 { color: var(--primary); margin-top: 0; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-scan { background: #34495e; }

        /* Style pour la zone QR et Cam√©ra */
        #qrcode { margin: 20px auto; display: flex; justify-content: center; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; }
        
        .status { padding: 10px; border-radius: 8px; margin-top: 15px; display: none; font-weight: bold; }
        .badge { background: var(--secondary); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="card">
        <span class="badge">üì± Vue Utilisateur</span>
        <h2>Mes √âco-points</h2>
        <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);">1,250 üåø</div>
        <p>R√©duction : -5‚Ç¨ chez mon r√©parateur v√©lo</p>
        
        <button class="btn" onclick="genererMonQR()">G√âN√âRER MA R√âCOMPENSE</button>
        
        <div id="qrcode"></div>
        <p id="info-code" style="font-size: 0.8rem; color: #666;"></p>
    </div>

    <div class="card" style="border-top: 5px solid #34495e;">
        <span class="badge" style="background: #34495e;">üè™ Vue Commer√ßant</span>
        <h2>Scanner un client</h2>
        
        <div id="reader"></div>
        
        <button class="btn btn-scan" onclick="demarrerScanner()">OUVRIR LA CAM√âRA</button>
        
        <div id="scan-result" class="status"></div>
    </div>

    <script>
        // --- LOGIQUE DE SIMULATION ---
        // Liste des codes valides (dans une vraie app, ce serait ta base de donn√©es)
        let codesValides = [];

        // 1. FONCTION : GENERER LE QR CODE (UTILISATEUR)
        function genererMonQR() {
            // On vide la zone si un code existe d√©j√†
            document.getElementById("qrcode").innerHTML = "";
            
            // On cr√©e un identifiant unique (ex: GT-LILLE-12345)
            const idUnique = "GT-LILLE-" + Math.floor(Math.random() * 10000);
            
            // On l'ajoute √† notre "base de donn√©es" temporaire
            codesValides.push(idUnique);

            // On utilise la biblioth√®que pour cr√©er l'image
            new QRCode(document.getElementById("qrcode"), {
                text: idUnique,
                width: 150,
                height: 150
            });

            document.getElementById("info-code").innerText = "Code g√©n√©r√© : " + idUnique;
        }

        // 2. FONCTION : SCANNER LE QR CODE (COMMER√áANT)
        function demarrerScanner() {
            const html5QrCode = new Html5Qrcode("reader");
            
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };

            html5QrCode.start(
                { facingMode: "environment" }, // Utilise la cam√©ra arri√®re
                config,
                (decodedText) => {
                    // Si on a r√©ussi √† lire un texte dans le QR Code
                    validerResultat(decodedText);
                    html5QrCode.stop(); // On arr√™te la cam√©ra apr√®s le scan
                },
                (errorMessage) => { /* On ignore les erreurs de lecture continue */ }
            ).catch(err => alert("Erreur de cam√©ra : " + err));
        }

        // 3. FONCTION : VALIDER SI LE CODE EXISTE
        function validerResultat(texteScanne) {
            const resultDiv = document.getElementById("scan-result");
            resultDiv.style.display = "block";

            // On v√©rifie si le texte scann√© est dans notre liste
            if (codesValides.includes(texteScanne)) {
                resultDiv.style.backgroundColor = "#d8f3dc";
                resultDiv.style.color = "#1b4332";
                resultDiv.innerHTML = "‚úÖ CODE VALIDE<br>R√©compense : " + texteScanne;
                
                // On retire le code de la liste pour qu'il ne soit plus r√©utilisable
                codesValides = codesValides.filter(c => c !== texteScanne);
            } else {
                resultDiv.style.backgroundColor = "#ffccd5";
                resultDiv.style.color = "#c9184a";
                resultDiv.innerHTML = "‚ùå CODE INVALIDE<br>D√©j√† utilis√© ou inconnu.";
            }
        }
    </script>
</body>
</html>